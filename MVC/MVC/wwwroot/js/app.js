"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var FeedbackSingleton=function(){var e;return{getInstance:function(){return e||(e=new FeedbackWidget("feedback-widget")),e}}}(),FeedbackWidget=function(){function e(t){_classCallCheck(this,e),console.log("Initializing FeedbackWidget with elementId:",t),this._elementId=t,this._timeout=null}return _createClass(e,[{key:"elementId",get:function(){return this._elementId}},{key:"show",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=$("#"+this._elementId),i=$("#feedback-section"),c=$('<button class="feedback-widget__close">×</button>');i.addClass("flex").removeClass("hidden"),a.empty().append(c).append("<span>".concat(e,"</span>"));var s=$('<div class="feedback-widget__actions"></div>');o.forEach(function(e){var t=$("<span>".concat(e.icon,"</span>"));t.addClass(e.class),t.on("click",e.callback),s.append(t)}),a.append(s),a.removeClass("hidden fade-out").addClass("visible alert alert-".concat(t.toLowerCase()," fade-in")),r&&(this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){return n.hide()},6e3)),c.on("click",function(){return n.hide()}),this.log({message:e,type:t})}},{key:"hide",value:function(){var e=$("#"+this._elementId),t=$("#feedback-section");e.removeClass("fade-in").addClass("fade-out"),setTimeout(function(){e.addClass("hidden").removeClass("visible fade-out").empty(),t.addClass("hidden").removeClass("flex")},500),this._timeout&&clearTimeout(this._timeout)}},{key:"log",value:function(e){var t=JSON.parse(localStorage.getItem("feedback_widget"))||{messages:[]};t.messages.unshift(e),t.messages.length>10&&t.messages.pop(),localStorage.setItem("feedback_widget",JSON.stringify(t))}},{key:"removeLog",value:function(){localStorage.removeItem("feedback_widget"),console.clear()}},{key:"history",value:function(){var e=JSON.parse(localStorage.getItem("feedback_widget")),t=(null===e||void 0===e?void 0:e.messages.map(function(e){return"".concat(e.type," - ").concat(e.message)}).join("\n"))||"No history.";console.clear(),console.log(t)}}])}(),Game=function(e){if(!(e&&e.apiUrl&&e.userToken&&e.redirectUrl))throw new Error("Game module initialization failed: Missing config properties.");var t={apiUrl:e.apiUrl,apiKey:e.userToken,redirectUrl:e.redirectUrl},n=function(){console.log("Game initialized with config:",t),r(),o(),Game.Data.init(t.apiUrl,t.apiKey,"production"),Game.Model.init(t.redirectUrl)},r=function(){if(!spa_templates||!spa_templates.body)throw new Error("Template 'body' is not available. Ensure the template is compiled and loaded.");var e=spa_templates.body();document.getElementById("body").innerHTML=e},o=function(){var e=FeedbackSingleton.getInstance();$("#game-board-container").on("click",".possible-move",function(t){var n=$(t.target).closest("td"),r=n.data("row"),o=n.data("col");Game.Data.sendMove(r,o).then(function(){e.log({message:"Move made on row ".concat(r," and col ").concat(o,"."),type:"Success"}),e.history()}).catch(function(t){e.log({message:"Move failed: ".concat(t.responseText||t),type:"Danger"})})}),$("#pass-button").on("click",function(){Game.Data.passGame().then(function(){e.log({message:"Turn passed.",type:"Success"}),e.history()}).catch(function(t){e.log({message:"Pass failed: "+t.responseText,type:"Danger"})})}),$("#forfeit-button").on("click",function(){e.show("Are you sure you want to forfeit?","info",!0,[{icon:"✓",class:"feedback-icon feedback-icon--success",callback:function(){Game.Data.forfeitGame().then(function(){e.removeLog(),e.hide()}).catch(function(t){e.log("Forfeit failed: "+t.responseText,"Danger")})}},{icon:"✕",class:"feedback-icon feedback-icon--danger",callback:function(){e.hide()}}])})},a=function(){Game.Othello.board(),setInterval(function(){Game.Model.getGameState()},1e3)};return{init:function(e){n(),a(),e&&e()}}}(config);$(function(){function e(){}Game.init(e)}),Game.Data=function(){var e={apiUrl:"",apiKey:"",mock:[{url:"api/game/view/<token>",key:"key",data:0}]},t={environment:""},n=function(n,r,o){if("production"==o)e.apiUrl=n,e.apiKey=r,t.environment=o;else{if("development"!=o)throw new Error("This environment is unknown.");e.mock.url=n+"data",e.mock.key=r,t.environment=o}},r=function(){if("production"==t.environment)return $.get(e.apiUrl+"view/"+e.apiKey).then(function(e){return e}).catch(function(e){console.log(e.message)});if("development"==t.environment)return l();throw new Error("This environment is unknown.")},o=function(){if("production"==t.environment)return $.get(e.apiUrl+"partial/"+e.apiKey).then(function(e){return e}).catch(function(e){console.log(e.message)});if("development"==t.environment)return l();throw new Error("This environment is unknown.")},a=function(t,n){var r=e.apiKey,o={playerToken:r,row:t,column:n};return $.ajax({url:e.apiUrl+"move",method:"POST",contentType:"application/json",data:JSON.stringify(o)}).then(function(e){Game.Model.getGameState()})},i=function(){var t=e.apiKey;return $.ajax({url:e.apiUrl+"pass",method:"POST",contentType:"application/json",data:JSON.stringify({token:t})}).then(function(e){Game.Model.getGameState()})},c=function(){var t=e.apiKey;return $.ajax({url:e.apiUrl+"forfeit",method:"POST",contentType:"application/json",data:JSON.stringify({token:t})}).then(function(e){Game.Model.getGameState()})},s=function(t){e.mock=t},l=function(){var t=e.mock;return new Promise(function(e,n){e(t)})};return{init:function(e,t,r){n(e,t,r)},get:function(){return r()},getPartial:function(){return o()},sendMove:function(e,t){return a(e,t)},passGame:function(){return i()},forfeitGame:function(){return c()},setMockData:function(e){s(e)}}}(),Game.Model=function(){var e={redirectUrl:null},t={firstLoad:!0,turnReload:!0,opponent:"",playerColor:"",board:null},n=function(t){e.redirectUrl=t},r=function(){return(t.firstLoad?Game.Data.get():Game.Data.getPartial()).then(function(n){if(t.firstLoad){if(!n.partial.inGame&&n.partial.finished)return void(window.location.href=e.redirectUrl);t.opponent=n.opponent,t.playerColor=n.color,t.board=n.partial.board,t.firstLoad=!1,o(t.opponent,t.playerColor),i(n.partial.isPlayersTurn,n.partial.possibleMove),a(n.partial.isPlayersTurn,n.partial.time)}else 0===n.playersTurn&&n.inGame?(Game.Othello.updateBoard(n.board,n.isPlayersTurn,t.playerColor),Game.Othello.highlightChanges(n.board)):n.inGame?n.isPlayersTurn?(t.turnReload&&(Game.Othello.updateBoard(n.board,n.isPlayersTurn,t.playerColor),Game.Othello.highlightChanges(n.board),i(n.isPlayersTurn,n.possibleMove),t.turnReload=!1,t.opponentReload=!0),a(n.isPlayersTurn,n.time),t.board=n.board):(t.turnReload||(Game.Othello.updateBoard(n.board,n.isPlayersTurn,t.playerColor),Game.Othello.makeMove(n.board),t.turnReload=!0),i(n.isPlayersTurn,n.possibleMove),a(n.isPlayersTurn,n.time),t.board=n.board):setTimeout(function(){window.location.href=e.redirectUrl},500);return n}).catch(function(e){return console.log(e.message),{data:null,error:e.message}})},o=function(e,t){var n=document.getElementById("player-info");document.getElementById("opponent-name").textContent=e,n.classList.add("flex","fade-in");var r=document.getElementById("player-color-indicator"),o=document.getElementById("opponent-color-indicator");r.classList.remove("white","black"),o.classList.remove("white","black"),1===t?(r.classList.add("white"),o.classList.add("black")):(r.classList.add("black"),o.classList.add("white")),document.getElementById("score-display").classList.add("flex","fade-in"),document.getElementById("player-score").id=1===t?"white-score":"black-score",document.getElementById("opponent-score").id=1===t?"black-score":"white-score"},a=function(e,t){var n=document.getElementById("timer-color-indicator");e?(n.classList.remove("red"),n.classList.add("green"),t.endsWith("0")||t.endsWith("5")||"4"===t||"3"===t||"2"===t||"1"===t?n.classList.add("wobble"):n.classList.remove("wobble")):(n.classList.remove("green"),n.classList.add("red")),document.getElementById("time-remaining").textContent=t},i=function(e,t){var n=document.getElementById("feedback-widget"),r=document.getElementById("button-container"),o=document.getElementById("pass-button"),a=document.getElementById("forfeit-button");e?(n.classList.add("visible"),n.classList.remove("hidden"),r.classList.add("flex"),r.classList.remove("hidden"),t?(o.classList.add("hidden"),o.classList.remove("inline-block")):(o.classList.add("inline-block","fade-in-wobble"),o.classList.remove("hidden")),a.classList.add("inline-block","fade-in"),a.classList.remove("hidden")):(n.classList.add("hidden"),n.classList.remove("visible"),r.classList.add("hidden"),r.classList.remove("flex"),o.classList.add("hidden"),o.classList.remove("inline-block","fade-in-wobble"),a.classList.add("hidden"),a.classList.remove("inline-block","fade-in"))},c=function(){return t.board};return{init:function(e){return n(e)},getGameState:function(){return r()},getBoard:c}}(),Game.Othello=function(){var e=function(){var e=document.getElementById("game-board-container");e.innerHTML="",e.classList.add("game-board-container");var t=document.createElement("table");t.className="othello-board";for(var n=0;n<8;n++){for(var r=document.createElement("tr"),o=0;o<8;o++){var a=document.createElement("td");a.dataset.row=n,a.dataset.col=o,a.classList.add("board-cell",(n+o)%2==0?"even":"odd","distort");var i=Math.random(),c=Math.random(),s=Math.random(),l=.02*(8*n+o);a.style.setProperty("--random-x",i),a.style.setProperty("--random-y",c),a.style.setProperty("--random-rot",s),a.style.setProperty("--animation-delay","".concat(l,"s")),r.appendChild(a)}t.appendChild(r)}e.appendChild(t)},t=function(e,t,r){var o=document.getElementById("game-board-container");o.innerHTML="",o.classList.remove("game-board-container");var a=document.createElement("table");a.className="othello-board";for(var i=0;i<8;i++){for(var c=document.createElement("tr"),s=0;s<8;s++){var l=document.createElement("td");l.dataset.row=i,l.dataset.col=s,l.classList.add("board-cell"),l.classList.add((i+s)%2==0?"even":"odd");var d=e[i][s],u=document.createElement("div");if(u.classList.add("cell-div"),1===d){var f=document.createElement("i");f.className="fa fa-circle white-piece",u.appendChild(f)}else if(2===d){var m=document.createElement("i");m.className="fa fa-circle black-piece",u.appendChild(m)}else if(3===d&&t){var p=document.createElement("div");p.className="possible-move",p.classList.add(1===r?"white-border":"black-border"),u.appendChild(p)}l.appendChild(u),c.appendChild(l)}a.appendChild(c)}o.appendChild(a),n()},n=function(){var e=0,t=0;document.querySelectorAll("#game-board-container td").forEach(function(n){var r=n.querySelector("i");r&&(r.classList.contains("white-piece")?e++:r.classList.contains("black-piece")&&t++)}),document.getElementById("white-score").textContent=e,document.getElementById("black-score").textContent=t},r=function(e){var t=Game.Model.getBoard()||[];document.querySelectorAll("#game-board-container td").forEach(function(n){var r,o=parseInt(n.dataset.row,10),a=parseInt(n.dataset.col,10),i=e[o][a];if(i!==((null===(r=t[o])||void 0===r?void 0:r[a])||0)&&(1===i||2===i)){var c=n.querySelector("i");c&&(c.classList.remove("highlight"),c.classList.add("glow"))}})},o=function(e){var t=Game.Model.getBoard()||[];document.querySelectorAll("#game-board-container td").forEach(function(n){var r,o=parseInt(n.dataset.row,10),a=parseInt(n.dataset.col,10),i=e[o][a];if(i!==((null===(r=t[o])||void 0===r?void 0:r[a])||0)&&(1===i||2===i)){var c=n.querySelector("i");c&&(c.classList.remove("glow"),c.classList.add("highlight"))}})};return{board:function(){return e()},updateBoard:function(e,n,r){t(e,n,r)},makeMove:function(e){r(e)},highlightChanges:function(e){o(e)}}}();